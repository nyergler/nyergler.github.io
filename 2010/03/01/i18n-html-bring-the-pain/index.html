<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>i18n HTML: Bring the Pain &#183; Nathan R. Yergler</title><meta name=title content="i18n HTML: Bring the Pain &#183; Nathan R. Yergler"><link rel=canonical href=https://nyergler.github.io/2010/03/01/i18n-html-bring-the-pain/><link type=text/css rel=stylesheet href=/css/main.bundle.min.4735e28405aff4160bd59ccda70d9a096bb5a4eb5f151bfdaaa0deebdfc5bf5083b144fc72ddc5c3a008c29d8709d081655db7a60d3e64d4176446438871a276.css integrity="sha512-RzXihAWv9BYL1ZzNpw2aCWu1pOtfFRv9qqDe69/Fv1CDsUT8ct3Fw6AIwp2HCdCBZV23pg0+ZNQXZEZDiHGidg=="><script type=text/javascript src=/js/appearance.min.12e98742cd283574d030a7fe55f29597df4ee214f7ff7075b4d19a64d046a602753c715295550be7899b661619cec89c679049d36c624681671a8013c1249896.js integrity="sha512-EumHQs0oNXTQMKf+VfKVl99O4hT3/3B1tNGaZNBGpgJ1PHFSlVUL54mbZhYZzsicZ5BJ02xiRoFnGoATwSSYlg=="></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="i18n HTML: Bring the Pain"><meta property="og:description" content="I have to stay up a little later this evening than I’d planned, so as a result I’m finally going through all the tabs and browser windows I’ve had open on my personal laptop."><meta property="og:type" content="article"><meta property="og:url" content="https://nyergler.github.io/2010/03/01/i18n-html-bring-the-pain/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2010-03-01T23:21:20+00:00"><meta property="article:modified_time" content="2010-03-01T23:21:20+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="i18n HTML: Bring the Pain"><meta name=twitter:description content="I have to stay up a little later this evening than I’d planned, so as a result I’m finally going through all the tabs and browser windows I’ve had open on my personal laptop."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"i18n HTML: Bring the Pain","headline":"i18n HTML: Bring the Pain","abstract":"I have to stay up a little later this evening than I’d planned, so as a result I’m finally going through all the tabs and browser windows I’ve had open on my personal laptop.","inLanguage":"en","url":"https:\/\/nyergler.github.io\/2010\/03\/01\/i18n-html-bring-the-pain\/","author":{"@type":"Person","name":"Nathan Yergler"},"copyrightYear":"2010","dateCreated":"2010-03-01T23:21:20\u002b00:00","datePublished":"2010-03-01T23:21:20\u002b00:00","dateModified":"2010-03-01T23:21:20\u002b00:00","keywords":["cc","i18n","license engine","zope"],"mainEntityOfPage":"true","wordCount":"762"}]</script><meta name=author content="Nathan Yergler"><link href=https://github.com/nyergler rel=me><link href=https://instagram.com/nyergler rel=me></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="flex justify-between py-6 font-semibold sm:items-center sm:py-10 text-neutral-900 dark:text-neutral print:hidden"><div><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>Nathan R. Yergler</a></div><nav><ul class="flex flex-col list-none sm:flex-row"><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/about/ title="Oh hai.">Bio</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/posts/ title=Posts>Blog</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/prints/ title=Prints>Prints</a></li></ul></nav></header><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header class=max-w-prose><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>Nathan R. Yergler</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/2010/03/01/i18n-html-bring-the-pain/>i18n HTML: Bring the Pain</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">i18n HTML: Bring the Pain</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2010-03-01 23:21:20 +0000 UTC">March 1, 2010</time></div></div></header><section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert"><div class="min-w-0 min-h-0 max-w-prose"><p>I have to stay up a little later this evening than I’d planned, so as a result I’m finally going through all the tabs and browser windows I’ve had open on my personal laptop. I think some of these have been “open” for <em>months</em> (yes, there have been browser restarts, but they’re always there when the session restores). One that I’ve meant to blog is Wil Clouser’s <a href=http://micropipes.com/blog/2009/09/01/using-substitution-strings-in-po-files/>post on string substitution in .po files</a> . It’s actually [at least] his second post on the subject, recanting his <a href=http://micropipes.com/blog/2007/07/26/ten-tips-for-website-localization/>prior advice</a> , coming around to what others told him previously: <strong>don’t use substitution strings in .po files.</strong></p><p>I wasn’t aware of Chris’s previous advice, but had I read it when first published, I would have nodded my head vigorously; after all, that’s how we <em>did</em> it. Er, that’s how we, uh, <em>do</em> it. And we’re not really in a position to change that at the moment, although we’ve certainly looked pretty hard at the issue.</p><p>A bit of background: One of the core pieces of technology we’ve built at Creative Commons is the <a href=http://creativecommons.org/choose/>license chooser</a> . It’s a relatively simple application, with a few wrinkles that make it interesting. It manages a lot of requests, a lot of languages, and has to spit out the right license (type, version, and jurisdiction) based on what the user provides. The really interesting thing it generates is some XHTML with RDFa that includes the license badge, name, and any additional information the user gives us; it’s this metadata that we use to generate the copy and paste attribution HTML on the deed. So what does this have to do with <a href=http://en.wikipedia.org/wiki/Internationalization_and_localization>internationalization</a> ? The HTML is internationalized. And it contains substitutions. Yikes.</p><p>To follow in the excellent example of AMO and Gnome, we’d start using English as our <code>msgid</code>s, leaving behind the current symbolic keys of the past. Unfortunately it’s not quite so easy. Every time we look at this issue (and for my first year as CTO we really looked; <a href=http://asheesh.org/>Asheesh</a> can atest we looked at it again and again) and think we’ve got it figured out, we realize there’s another corner case that doesn’t quite work.</p><p>The real issue with the HTML <strong>is</strong> the HTML: <a href=http://pypi.python.org/pypi/zope.i18n>zope.i18n</a> , our XSLT selectors<sup>†</sup>, the ZPT parse tree: none of them really play all that well with HTML <code>msgid</code>s. The obvious solution would be to get rid of the HTML in translation, and we’ve tried doing that, although we keep coming back to our current approach. I guess we’re always seduced by keeping all the substitution in one place, and traumatized by the time we tried assembling the sentences from smaller pieces<sup>‡</sup>.</p><p>So if we accept that we’re stuck with the symbolic identifiers, what do we do? Build tools, of course. This wasn’t actually an issue until we started using a “real” translation tool — <a href=http://translate.sourceforge.net/wiki/pootle/index>Pootle</a> , to be specific. Pootle is pretty powerful, but some of the features depend on having “English” <code>msgid</code>s. Luckily it has no qualms about HTML in those <code>msgid</code>s, it has decent <a href=http://en.wikipedia.org/wiki/Revision_control>VCS</a> support, and we know how to write post-commit hooks.</p><p>To support Pootle and provide a better experience for our translators, we maintain two sets of PO files: the “CC style” symbolic <code>msgid</code> files, and the “normal” English <code>msgid</code> files. We keep a separate “master” PO file where the msgid is the “CC style” <code>msgid</code>, and the “translation” is the English <code>msgid</code>. It’s this file that we update when we need to make changes, and luckily using that format actually makes the extraction work the way it’s supposed to. Or close. And when a user commits their work from Pootle (to the “normal” PO file), a post-commit hook keeps the other version in sync.</p><p>While we’ve gotten a lot better at this and have learned to live with this system, it’s far from perfect. The biggest imperfection is its custom nature: I’m still the “expert”, so when things go wrong, I get called first. And when people want to work on the code, it takes some extra indoctrination before they’re productive. My goal is still to get to a single set of PO files, but for now, this is what we’ve got. Bring the pain.</p><hr><p><sup>†</sup> For a while, at least. We’re working on a <a href=http://code.creativecomons.org/viewgit/cc.engine.git>new version of the chooser</a> driven by our the license RDF. This will be better for re-use, but not really an improvement in this area.</p><p><sup>‡</sup> This works great in English, but in languages where gender is more strongly expressed in the word forms, uh, not so much.</p></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group" href=/2010/02/28/read-the-paperboy-by-pete-dexter/><span class="mr-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Read: “The Paperboy”, by Pete Dexter</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2010-02-28 19:06:06 +0000 UTC">February 28, 2010</time></span></span></a></span>
<span><a class="flex text-right group" href=/2010/03/05/read-fordlandia-by-greg-grandin/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Read: “Fordlandia”, by Greg Grandin</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2010-03-05 15:15:41 +0000 UTC">March 5, 2010</time></span></span>
<span class="ml-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div class="absolute top-[110vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-0"><a href=#the-top class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5.5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer class="py-10 print:hidden"><nav class="pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>Tags</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/categories/ title=Categories>Categories</a></li></ul></nav><div class="flex justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2022
Nathan Yergler</p></div></div></footer></div></body></html>