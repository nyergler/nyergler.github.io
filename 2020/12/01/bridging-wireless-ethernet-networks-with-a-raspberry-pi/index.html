<!doctype html><html lang=en><head>
<meta charset=utf-8>
<meta http-equiv=content-language content="en">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="ie=edge">
<title>Bridging Wireless & Ethernet networks with a Raspberry Pi &#183; Nathan R. Yergler</title>
<meta name=title content="Bridging Wireless & Ethernet networks with a Raspberry Pi &#183; Nathan R. Yergler">
<meta name=description content>
<link rel=canonical href=https://nyergler.github.io/2020/12/01/bridging-wireless-ethernet-networks-with-a-raspberry-pi/>
<link type=text/css rel=stylesheet href=/css/schemes/ocean.min.ff17c50528c7a4a8a8bb8ec41272d63eb936ecefb9ccfa6db45cd1f5cd8b1becf8606745f751ee0d322ac80c9cb96e58aa699b38aa44cff9d2a8b3ff4f05a7b5.css integrity="sha512-/xfFBSjHpKiou47EEnLWPrk27O+5zPpttFzR9c2LG+z4YGdF91HuDTIqyAycuW5YqmmbOKpEz/nSqLP/TwWntQ==">
<link type=text/css rel=stylesheet href=/css/compiled/main.min.84c4218572228cacf6182dc59fe08b5e1bcd599bb583bc56976aa0070f4cd8a4ff130ee2313074359bf6dba03b211e8c50df743d84ad551575fd0b9f849ec802.css integrity="sha512-hMQhhXIijKz2GC3Fn+CLXhvNWZu1g7xWl2qgBw9M2KT/Ew7iMTB0NZv226A7IR6MUN90PYStVRV1/QufhJ7IAg==">
<script>function loadPreferredAppearance(){localStorage.preferredAppearance==="dark"||!("preferredAppearance"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}function setPreferredAppearance(a){a=="default"?localStorage.removeItem("preferredAppearance"):localStorage.preferredAppearance=a,loadPreferredAppearance()}loadPreferredAppearance(),window.matchMedia("(prefers-color-scheme: dark)").addListener(loadPreferredAppearance)</script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/site.webmanifest>
<meta property="og:title" content="Bridging Wireless & Ethernet networks with a Raspberry Pi">
<meta property="og:description" content="We recently acquired a second hand Dell laser printer, which was timely: our inkjet printer is a little long in the tooth, and is starting to require more frequent head cleaning and nozzle alignment, both of which use that liquid gold we call “ink”.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://nyergler.github.io/2020/12/01/bridging-wireless-ethernet-networks-with-a-raspberry-pi/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2020-12-01T04:10:25+00:00">
<meta property="article:modified_time" content="2020-12-01T04:10:25+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Bridging Wireless & Ethernet networks with a Raspberry Pi">
<meta name=twitter:description content="We recently acquired a second hand Dell laser printer, which was timely: our inkjet printer is a little long in the tooth, and is starting to require more frequent head cleaning and nozzle alignment, both of which use that liquid gold we call “ink”.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","articleSection":"Posts","name":"Bridging Wireless \u0026 Ethernet networks with a Raspberry Pi","headline":"Bridging Wireless \u0026 Ethernet networks with a Raspberry Pi","description":"We recently acquired a second hand Dell laser printer, which was timely: our inkjet printer is a little long in the tooth, and is starting to require more frequent head cleaning and nozzle alignment, both of which use that liquid gold we call “ink”.","inLanguage":"en","author":{"@type":"Person","name":"Nathan Yergler"},"creator":{"@type":"Person","name":"Nathan Yergler"},"copyrightHolder":"Nathan Yergler","copyrightYear":"2020","dateCreated":"2020-12-01T04:10:25\u002b00:00","datePublished":"2020-12-01T04:10:25\u002b00:00","dateModified":"2020-12-01T04:10:25\u002b00:00","url":"https:\/\/nyergler.github.io\/2020\/12\/01\/bridging-wireless-ethernet-networks-with-a-raspberry-pi\/","wordCount":"715","keywords":["homelab","network","raspberrypi"]}</script>
<meta name=author content="Nathan Yergler">
<link href=https://github.com/nyergler rel=me>
<link href=https://instagram.com/nyergler rel=me>
</head>
<body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"><header class="flex justify-between py-6 font-semibold sm:items-center sm:py-10 text-neutral-900 dark:text-neutral">
<div>
<a class="hover:underline hover:underline-primary-500 hover:underline-thickness-bold hover:underline-offset-small" rel=me href=/>Nathan R. Yergler</a>
</div>
<nav>
<ul class="flex flex-col list-none sm:flex-row">
<li class="mb-1 text-right sm:mb-0 sm:mr-7 sm:last:mr-0">
<a class="hover:underline hover:underline-primary-500 hover:underline-thickness-bold hover:underline-offset-small" href=/about/ title="Oh hai.">Bio</a>
</li>
<li class="mb-1 text-right sm:mb-0 sm:mr-7 sm:last:mr-0">
<a class="hover:underline hover:underline-primary-500 hover:underline-thickness-bold hover:underline-offset-small" href=/posts/ title=Posts>Blog</a>
</li>
<li class="mb-1 text-right sm:mb-0 sm:mr-7 sm:last:mr-0">
<a class="hover:underline hover:underline-primary-500 hover:underline-thickness-bold hover:underline-offset-small" href=/prints/ title=Prints>Prints</a>
</li>
</ul>
</nav>
</header>
<main class=flex-grow>
<article class=max-w-prose>
<header>
<ol class="text-sm text-neutral-500 dark:text-neutral-400">
<li class="inline hidden">
<a class="hover:underline hover:underline-neutral-300 dark:underline-neutral-600" href=/>Nathan R. Yergler</a><span class="px-1 text-primary-500">/</span>
</li>
<li class=inline>
<a class="hover:underline hover:underline-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span>
</li>
<li class="inline hidden">
<a class="hover:underline hover:underline-neutral-300 dark:underline-neutral-600" href=/2020/12/01/bridging-wireless-ethernet-networks-with-a-raspberry-pi/>Bridging Wireless & Ethernet networks with a Raspberry Pi</a><span class="px-1 text-primary-500">/</span>
</li>
</ol>
<h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
Bridging Wireless & Ethernet networks with a Raspberry Pi
</h1>
<div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400">
<div class="flex flex-row items-center">
<time datetime="2020-12-01 04:10:25 +0000 UTC">1 December 2020</time>
</div>
</div>
</header>
<section class="prose dark:prose-light">
<p>We recently acquired a second hand Dell laser printer, which was timely: our
inkjet printer is a little long in the tooth, and is starting to require more
frequent head cleaning and nozzle alignment, both of which use that liquid gold
we call “ink”.</p>
<p>Unfortunately, the laser printer only supported ethernet out of the box, and
while a wireless adapter <em>was</em> available, it was retailing for over $150.
Fortunately, however, I had a <a href=https://raspberrypi.org>Raspberry Pi</a> lying around, that I was able to
turn into a working solution.</p>
<p>There are plenty of posts out there talking about bridging networks with
Raspberry Pi and Linux, but most of them seemed to either <a href=https://raspberrypi.stackexchange.com/questions/88954/workaround-for-a-wifi-bridge-on-a-raspberry-pi-with-proxy-arp>assume I care about
systemd</a> (I don’t), <a href=https://tldp.org/HOWTO/Proxy-ARP-Subnet/setup.html>want to deal with static IP addresses</a> (I
don’t), or <a href=https://wiki.debian.org/BridgeNetworkConnections>want to bridge two ethernet networks</a> (I don’t). So
here’s what worked for me.</p>
<p>There were two inflection points in getting this to work: the first was
understanding that I don’t <em>really</em> want a Bridge: I want an ARP<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>
Proxy. What’s the difference? Simply put: a Proxy can inspect and modify
traffic going through it, while a Bridge does not. Why do we care about that?
Because wireless access points are fickle creatures, and will often discard
traffic originating from a host they don’t know about. Additionally, there
are restrictions built into the bridge utilities that prevent you from doing a
direct bridge from ethernet to wireless. By running a proxy, we’re able to
make the bridged traffic (from our printer) appear as if it’s originating
from the Raspberry Pi, which the access point <em>definitely</em> knows about.</p>
<p>I knew that DHCP would be involved if I didn’t want to deal with static IP
addresses. The second inflection point was realizing that in order to make that
work, and to make it transparent-ish from either side of the bridge, I needed to
make sure the ethernet (eth0) and wireless (wlan0) ports had the same IP
address. More on how in a moment.</p>
<p>Here are the steps I followed, largely based on the <a href=https://wiki.debian.org/BridgeNetworkConnectionsProxyArp>Debian wiki</a>:</p>
<ol>
<li>
<p>Configure your Raspberry Pi with Raspbian and connect it to your wireless network. Getting this out of the way first will configure WPA supplicant, which is responsible for managing the wireless authentication and pre-shared keys. If you’re interested, <code>/etc/wpa_supplicant/wpa_supplicant.conf</code> will hold your configuration after you’re connected.</p>
</li>
<li>
<p>Install the proxy daemon and helpers we’re going to use: <code>parprouted</code> and <code>dhcp-helper</code></p>
</li>
</ol>
<pre class=wp-block-code><code>$ sudo apt-get install parprouted dhcp-helper</code></pre>
<ol start=3>
<li>
<p>Configure <code>dhcp-helper</code> to broadcast on <code>wlan0</code></p>
<p>Add the following contents to <code>/etc/default/dhcp-helper</code>.</p>
<pre tabindex=0><code># relay dhcp requests as broadcast to wlan0
DHCPHELPER_OPTS=&quot;-b wlan0&quot;
</code></pre></li>
<li>
<p>Configure mDNS: when your printer magically appears in the Add Printer list,
that’s mDNS at work. And we definitely want it to just show up,
otherwise we’ll be back in static IP land. To do this, we need to
reflect messages from one network to the other. Luckily, Avahi, the Linux
mDNS implementation installed with Raspbian, makes this a one-line change.</p>
<p>Enable the Reflector in <code>/etc/avahi/avahi-daemon.conf</code>.</p>
<pre tabindex=0><code>[reflector]
enable-reflector=yes
</code></pre></li>
<li>
<p>Configure your network interfaces</p>
<p>While we’re most interested in our ethernet (eth0) and wireless
(wlan0) interfaces, there are actually three interfaces for us to configure:
loopback, ethernet, and wireless. I created a file for each in the
<code>/etc/network/interfaces.d/</code> directory.</p>
<p><strong><code>lo</code></strong></p>
<pre tabindex=0><code>auto lo
iface lo inet loopback&lt;/code&gt;&lt;/pre&gt;
</code></pre><p><strong><code>eth0</code></strong></p>
<pre tabindex=0><code>auto eth0
allow-hotplug eth0
iface eth0 inet manual
</code></pre><p><strong><code>wlan0</code></strong></p>
<p>This is where the magic actually happens. I mentioned before that we need to bind the same IP address to both network interfaces. We also need to restart the DHCP Helper and proxy. We wire this up with <code>post-up</code> and <code>post-down</code> clauses in our <code>wlan0</code> configuration: every <code>post-up</code> line is executed after the network interface comes up, and every <code>post-down</code> line is executed after it goes, ahem, down.</p>
<pre tabindex=0><code>auto wlan0
allow-hotplug wlan0
iface wlan0 inet dhcp
wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf
  post-up /sbin/ip addr add $(/sbin/ip addr show wlan0 | perl -wne 'm|^\s+inet (.*)/| &amp;&amp; print $1')/32 dev eth0
  post-up /sbin/ifup eth0
  post-up /usr/sbin/parprouted wlan0 eth0
  post-up /etc/init.d/dhcp-helper start
  post-down /usr/bin/killall /usr/sbin/parprouted
  post-down /etc/init.d/dhcp-helper stop
  post-down /sbin/ifdown eth0
</code></pre></li>
<li>
<p>Restart.</p>
<p>At this point your printer should be able to obtain an IP address using DHCP
from your wireless network, and the printer should show up to your wireless
clients.</p>
</li>
</ol>
<section class=footnotes role=doc-endnotes>
<hr>
<ol>
<li id=fn:1 role=doc-endnote>
<p>Address Resolution Protocol, which is used to map IP addresses to MAC
addresses. Yeah, I forget it exists, too.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
</ol>
</section>
</section>
<footer class=pt-8>
<div class="pt-8 article-pagination">
<hr class="border-dotted border-neutral-300 dark:border-neutral-600">
<div class="flex justify-between pt-3">
<span>
<a class=flex href=/2020/12/14/the-origin-of-the-parable/>
<span class="mr-3 article-pagination-direction">&larr;</span>
<span class="flex flex-col">
<span class="article-pagination-title mt-[0.1rem] leading-6">
The origin of the parable</span>
<span class="mt-[0.1rem] text-xs text-neutral-400 dark:text-neutral-500">
<time datetime="2020-12-14 04:36:17 +0000 UTC">14 December 2020</time>
</span>
</span>
</a>
</span>
<span>
<a class="flex text-right" href=/2020/08/10/3780/>
<span class="flex flex-col">
<span class="article-pagination-title mt-[0.1rem] leading-6">10 August 2020</span>
<span class="mt-[0.1rem] text-xs text-neutral-400 dark:text-neutral-500">
</span>
</span>
<span class="ml-3 article-pagination-direction">&rarr;</span>
</a>
</span>
</div>
</div>
</footer>
</article>
</main><footer class=py-10>
<nav class="pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
<ul class="flex flex-col list-none sm:flex-row">
<li class="mb-1 sm:mb-0 sm:mr-7 sm:last:mr-0">
<a class="hover:underline hover:underline-primary-500 hover:underline-thickness-bold hover:underline-offset-small" href=/tags/ title=Tags>Tags</a>
</li>
<li class="mb-1 sm:mb-0 sm:mr-7 sm:last:mr-0">
<a class="hover:underline hover:underline-primary-500 hover:underline-thickness-bold hover:underline-offset-small" href=/categories/ title=Categories>Categories</a>
</li>
</ul>
</nav>
<div class="flex justify-between">
<div>
<p class="text-sm text-neutral-500 dark:text-neutral-400">
&copy;
2022
Nathan Yergler
</p>
</div>
</div>
</footer>
</body>
</html>