{{- if not ($.Page.Scratch.Get "figurecount") }}<link rel="stylesheet" href="/photoswipe/photoswipe.css"/>{{ end }}
{{- $.Page.Scratch.Add "figurecount" 1 }}
{{ $baseURL := .Site.BaseURL }}
{{ $dir := print "content/" $.Page.File.Dir }}

<div class="gallery-container">
<div id="gallery" class="gallery">
	{{- $files := readDir $dir }}
	{{- range $files -}}
		{{- $isthumb := .Name | findRE ("-\\d+x\\d+" | printf "%s\\.") }}<!-- is the current file a thumbnail image? -->
		{{- $isimg := lower .Name | findRE "\\.(gif|jpg|jpeg|tiff|png|bmp)" }}<!-- is the current file an image? -->
		{{- if and $isimg (not $isthumb) (not (eq .Name $.Page.Params.image))}}
			{{- $linkURL := print $baseURL $.Page.File.Dir "/" .Name | absURL }}<!-- absolute URL to hi-res image -->
			<a href="{{ $linkURL }}"
				data-pswp-width="1669"
				data-pswp-height="2500"
				data-cropped="true"
				target="_blank">
			<img src="{{ $linkURL }}" alt="" />
		  </a>
		{{- end }}
	{{- end }}
</div>
</div>
<script type="module">
    // Include Lightbox
    import PhotoSwipeLightbox from '/photoswipe/photoswipe-lightbox.esm.js';

    const lightbox = new PhotoSwipeLightbox({
      // may select multiple "galleries"
      gallery: '#gallery',

      // Elements within gallery (slides)
      children: 'a',

      // Include PhotoSwipe Core
      // and use absolute path (that starts with http(s)://)
    //   pswpModule: 'http://localhost:1313/photoswipe/v5-6004016/photoswipe.esm.js'
      // setup PhotoSwipe Core dynamic import
      pswpModule: () => import('/photoswipe/photoswipe.esm.js')
    });
	console.log("INIT")
    lightbox.init();
</script>